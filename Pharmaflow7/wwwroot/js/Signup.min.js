let currentStep = 1; // تعريف currentStep من البداية

function adjustFields() {
    const userType = document.getElementById('userType').value;
    console.log('Adjusting fields for userType:', userType); // Logging للتأكد
    document.getElementById('consumerFields').style.display = userType === 'consumer' ? 'block' : 'none';
    document.getElementById('companyFields').style.display = userType === 'company' ? 'block' : 'none';
    document.getElementById('distributorFields').style.display = userType === 'distributor' ? 'block' : 'none';
}

function validateStep1() {
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value.trim();
    const confirmPassword = document.getElementById('confirmPassword').value.trim();
    const userType = document.getElementById('userType').value;

    let isValid = true;

    console.log('Validating Step 1:', { email, userType }); // Logging للتأكد

    if (!userType) {
        document.getElementById('emailError').textContent = 'Please select a user type.';
        document.getElementById('emailError').style.display = 'block';
        isValid = false;
    } else {
        document.getElementById('emailError').style.display = 'none';
    }

    if (!email || !email.includes('@')) {
        document.getElementById('emailError').textContent = 'Please enter a valid email address.';
        document.getElementById('emailError').style.display = 'block';
        isValid = false;
    } else {
        document.getElementById('emailError').style.display = 'none';
    }

    if (password.length < 8) {
        document.getElementById('passwordError').textContent = 'Password must be at least 8 characters.';
        document.getElementById('passwordError').style.display = 'block';
        isValid = false;
    } else {
        document.getElementById('passwordError').style.display = 'none';
    }

    if (password !== confirmPassword) {
        document.getElementById('confirmPasswordError').textContent = 'Passwords do not match.';
        document.getElementById('confirmPasswordError').style.display = 'block';
        isValid = false;
    } else {
        document.getElementById('confirmPasswordError').style.display = 'none';
    }

    if (isValid) {
        console.log('Step 1 validated, moving to Step 2'); // Logging للتأكد
        adjustFields();
        nextStep(2);
    }
}

function validateStep2() {
    const userType = document.getElementById('userType').value;
    let isValid = true;

    console.log('Validating Step 2 for userType:', userType); // Logging للتأكد

    if (userType === 'consumer') {
        const fullName = document.getElementById('fullName').value.trim();
        if (!fullName) {
            document.getElementById('fullName').nextElementSibling.textContent = 'Full Name is required.';
            isValid = false;
        }
    } else if (userType === 'company') {
        const companyName = document.getElementById('companyName').value.trim();
        const licenseNumber = document.getElementById('licenseNumber').value.trim();
        const companyContact = document.getElementById('companyContact').value.trim();
        if (!companyName) {
            document.getElementById('companyName').nextElementSibling.textContent = 'Company Name is required.';
            isValid = false;
        }
        if (!licenseNumber) {
            document.getElementById('licenseNumber').nextElementSibling.textContent = 'License Number is required.';
            isValid = false;
        }
        if (!companyContact) {
            document.getElementById('companyContact').nextElementSibling.textContent = 'Contact Number is required.';
            isValid = false;
        }
    } else if (userType === 'distributor') {
        const distributorName = document.getElementById('distributorName').value.trim();
        const warehouseAddress = document.getElementById('warehouseAddress').value.trim();
        const distributorContact = document.getElementById('distributorContact').value.trim();
        if (!distributorName) {
            document.getElementById('distributorName').nextElementSibling.textContent = 'Distributor Name is required.';
            isValid = false;
        }
        if (!warehouseAddress) {
            document.getElementById('warehouseAddress').nextElementSibling.textContent = 'Warehouse Address is required.';
            isValid = false;
        }
        if (!distributorContact) {
            document.getElementById('distributorContact').nextElementSibling.textContent = 'Contact Number is required.';
            isValid = false;
        }
    }

    if (isValid) {
        console.log('Step 2 validated, submitting form'); // Logging للتأكد
        document.getElementById('signupForm').submit();
    }
}

function nextStep(step) {
    console.log('Moving to step:', step); // Logging للتأكد
    document.getElementById(`step${currentStep}`).classList.remove('active');
    document.getElementById(`step${step}`).classList.add('active');
    currentStep = step;

    const progress = (step / 2) * 100;
    document.querySelector('.progress-bar').style.width = `${progress}%`;
}

function prevStep(step) {
    console.log('Moving back to step:', step); // Logging للتأكد
    document.getElementById(`step${currentStep}`).classList.remove('active');
    document.getElementById(`step${step}`).classList.add('active');
    currentStep = step;

    const progress = (step / 2) * 100;
    document.querySelector('.progress-bar').style.width = `${progress}%`;
}

function loginWithGoogle() {
    console.log('Redirecting to Google login'); // Logging للتأكد
    window.location.href = '/Auth/ExternalLogin?provider=Google';
}

function loginWithFacebook() {
    console.log('Redirecting to Facebook login'); // Logging للتأكد
    window.location.href = '/Auth/ExternalLogin?provider=Facebook';
}