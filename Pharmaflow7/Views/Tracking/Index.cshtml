@{
    ViewData["Title"] = "Tracking";
}
<!-- Sidebar -->
<div class="sidebar">
    <h4>Medicine Tracking</h4>
    <a href="company-dashboard.html"><i class="fas fa-tachometer-alt me-2"></i> Dashboard</a>
    <a href="add-product.html"><i class="fas fa-plus-circle me-2"></i> Add Product</a>
    <a href="manage-products.html"><i class="fas fa-boxes me-2"></i> Manage Products</a>
    <a href="#" class="active"><i class="fas fa-truck me-2"></i> Track Shipments</a>
    <a href="reports.html"><i class="fas fa-chart-line me-2"></i> Reports</a>
    <a href="login.html"><i class="fas fa-sign-out-alt me-2"></i> Logout</a>
</div>

<!-- Main Content -->
<div class="content">
    <h1 class="mb-4">Track Shipments</h1>

    <!-- Shipments Table -->
    <div class="mb-4">
        <h3>Shipment List</h3>
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>Shipment ID</th>
                        <th>Product</th>
                        <th>Destination</th>
                        <th>Status</th>
                        <th>Current Location</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="shipmentTableBody">
                    <!-- Shipments will be added here dynamically -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Map -->
    <div class="card p-3">
        <h3>Shipment Locations</h3>
        <div id="map"></div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap" async defer></script>
<script>
    // Sample shipment data (to be replaced with real data from Backend)
    const shipments = [
        { id: 'SH12345', product: 'Paracetamol 500mg', destination: 'Cairo Pharmacy', status: 'In Transit', location: { lat: 30.0444, lng: 31.2357 }, currentLocation: 'Cairo' },
        { id: 'SH12346', product: 'Amoxicillin 250mg', destination: 'Alexandria Dist.', status: 'Delivered', location: { lat: 31.2001, lng: 29.9187 }, currentLocation: 'Alexandria' },
        { id: 'SH12347', product: 'Ibuprofen 400mg', destination: 'Giza Pharmacy', status: 'Processing', location: { lat: 30.0131, lng: 31.2089 }, currentLocation: 'Giza' }
    ];

    // Load shipments into the table
    function loadShipments() {
        const tbody = document.getElementById('shipmentTableBody');
        tbody.innerHTML = '';
        shipments.forEach(shipment => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${shipment.id}</td>
                <td>${shipment.product}</td>
                <td>${shipment.destination}</td>
                <td><span class="badge ${shipment.status === 'In Transit' ? 'bg-warning' : shipment.status === 'Delivered' ? 'bg-success' : 'bg-info'}">${shipment.status}</span></td>
                <td>${shipment.currentLocation}</td>
                <td><button class="btn btn-primary btn-sm" onclick="showOnMap(${shipment.location.lat}, ${shipment.location.lng}, '${shipment.id}')">View on Map</button></td>
            `;
            tbody.appendChild(row);
        });
    }

    // Initialize Google Map
    let map;
    let markers = [];
    function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
            center: { lat: 30.0444, lng: 31.2357 }, // Default center (Cairo)
            zoom: 6
        });

        // Add markers for all shipments
        shipments.forEach(shipment => {
            const marker = new google.maps.Marker({
                position: shipment.location,
                map: map,
                title: `${shipment.id} - ${shipment.product}`,
                icon: shipment.status === 'Delivered' ? 'http://maps.google.com/mapfiles/ms/icons/green-dot.png' :
                      shipment.status === 'In Transit' ? 'http://maps.google.com/mapfiles/ms/icons/yellow-dot.png' :
                      'http://maps.google.com/mapfiles/ms/icons/blue-dot.png'
            });
            markers.push(marker);

            // Info window for each marker
            const infoWindow = new google.maps.InfoWindow({
                content: `<h5>${shipment.id}</h5><p>Product: ${shipment.product}</p><p>Status: ${shipment.status}</p><p>Location: ${shipment.currentLocation}</p>`
            });
            marker.addListener('click', () => {
                infoWindow.open(map, marker);
            });
        });
    }

    // Show specific shipment on map
    function showOnMap(lat, lng, shipmentId) {
        map.setCenter({ lat, lng });
        map.setZoom(12);
        markers.forEach(marker => {
            if (marker.title.includes(shipmentId)) {
                new google.maps.InfoWindow({
                    content: marker.title
                }).open(map, marker);
            }
        });
    }

    // Initial load
    loadShipments();
</script>